<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"conversation_controller.js.html":{"id":"conversation_controller.js.html","title":"Source: conversation/controller.js","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Source: conversation/controller.js const logger = require('../../modules/logger'); const models = require('../../modules/dal/database').models(); const parse = require('co-body'); const conversationHelper = require('../../modules/service/helpers/conversation'); /** * Conversation Controller * * @module conversationController */ module.exports = { /** Find a conversation for a username. @param username {string} - GET /conversation/username */ * findByUserName() { logger.log('debug', 'Get Conversation'); var user = yield models.user.findOne().where({ username: this.params.id }); this.body = yield models.conversation.find().populate('messages').populate('participants', { where: { id: user.id } }).then(function (conversations) { logger.log('debug', `Got ${conversations.length} conversations for ${user.username}.`) return conversations; }); }, /** create a new conversation. @param JSON {string} - POST /conversation/create { &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;subject&quot;: &quot;Dear Friend&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot; } */ * create() { const body = yield parse.json(this); var to = yield conversationHelper.findUserByName(body.to); var from = yield conversationHelper.findUserByName(body.from); var newConversation = yield models.conversation.create(); newConversation.subject = body.subject; newConversation.participants.push(to); newConversation.participants.push(from); var date = new Date(); var newMessage = yield models.message.create({ to: to.id, from: from.id, messageText: body.message, seen: false, date: date }); newConversation.messages.push(newMessage); logger.log('debug', `Create conversation between ${to.id} and ${from.id}`); this.body = yield models.conversation.update(newConversation.id, newConversation); }, * destroy() { logger.log('debug', `Destory conversation ${this.params.id}.`); models.conversation.findOne().where({ id: this.params.id }).populate('messages').then(function (conversation) { if (!conversation || conversation.messages.length == 0) { return } conversation.messages.forEach(message =&gt; { message.destroy(); }); }); this.body = yield models.conversation.destroy({ id: this.params.id, }); }, * update() { const body = yield parse.json(this); logger.log('debug', `Update conversation ${body.conversationId}.`); var conversation = yield models.conversation.findOne( {id: body.conversationId} ).populate('messages'); if (!conversation) return this.body = '{ &quot;INFO&quot;: &quot;No conversation found matching requested conversationId.&quot;}'; var to = yield conversationHelper.findUserByName(body.to); var from = yield conversationHelper.findUserByName(body.from); var date = new Date(); var newMessage = yield models.message.create({ to: to.id, from: from.id, messageText: body.message, seen: false, date: date }); conversation.messages.push(newMessage); this.body = yield models.conversation.update(conversation.id, conversation); }, }; × Search results Close "},"conversation_model.js.html":{"id":"conversation_model.js.html","title":"Source: conversation/model.js","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Source: conversation/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * Conversation Model * * @module conversationModel */ module.exports = Waterline.Collection.extend({ identity: 'conversation', tableName: 'conversations', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { participants: { collection: 'user', }, messages: { collection: 'message', }, datestarted: 'datetime', subject: 'string' }, }); × Search results Close "},"conversation_message_model.js.html":{"id":"conversation_message_model.js.html","title":"Source: conversation/message/model.js","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Source: conversation/message/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * Message Model * * @module messageModel */ module.exports = Waterline.Collection.extend({ identity: 'message', tableName: 'messages', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { from: { model: 'user' }, to: { model: 'user' }, date: 'datetime', seen: 'boolean', messageText: 'string' }, }); × Search results Close "},"user_model.js.html":{"id":"user_model.js.html","title":"Source: user/model.js","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Source: user/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * User Model * * @module userModel */ module.exports = Waterline.Collection.extend({ identity: 'user', tableName: 'users', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { username: 'string' }, }); × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Modules × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel × Search results Close "},"module-conversationController.html":{"id":"module-conversationController.html","title":"Module: conversationController","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Module: conversationController Conversation Controller Source: conversation/controller.js, line 7 Methods &lt;static&gt; create(JSON) create a new conversation. Parameters: Name Type Description JSON string POST /conversation/create{ &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;subject&quot;: &quot;Dear Friend&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot;} Source: conversation/controller.js, line 42 &lt;static&gt; findByUserName(username) Find a conversation for a username. Parameters: Name Type Description username string GET /conversation/username Source: conversation/controller.js, line 16 × Search results Close "},"module-conversationModel.html":{"id":"module-conversationModel.html","title":"Module: conversationModel","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Module: conversationModel Conversation Model Source: conversation/model.js, line 6 × Search results Close "},"module-messageModel.html":{"id":"module-messageModel.html","title":"Module: messageModel","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Module: messageModel Message Model Source: conversation/message/model.js, line 6 × Search results Close "},"module-userModel.html":{"id":"module-userModel.html","title":"Module: userModel","body":" Youve Got Mail Modules conversationControllerconversationModelmessageModeluserModel Module: userModel User Model Source: user/model.js, line 6 × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
