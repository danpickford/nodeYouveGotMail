<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"service_index.js.html":{"id":"service_index.js.html","title":"Source: service/index.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: service/index.js 'use strict'; const config = require('../../modules/dal/config'); const database = require('../../modules/dal/database'); const logger = require('../../modules/logger'); /** * App * * @module app */ module.exports = { init(service, initWaterlineComplete) { const orm = database.connect(); try { const user = require(`../../modules/user/model`); const conversation = require(`../../modules/conversation/model`); const message = require(`../../modules/conversation/message/model`); orm.loadCollection(user); orm.loadCollection(conversation); orm.loadCollection(message); } catch (err) { if (err.code !== 'MODEL_LOAD_FAILURE') { throw new Error(`Error loading models: ${err.message}`); } } orm.initialize(config.database, (er, models) =&gt; { if (er) throw er; database.loadModels(models.collections); try { const conversationRoutes = require(`../../modules/conversation/routes`); const userRoutes = require(`../../modules/user/routes`); conversationRoutes(service); userRoutes(service); } catch (err) { if (err.code !== 'ROUTE_LOAD_FAILURE') { throw new Error(`Error loading routes: ${err.message}`); } } initWaterlineComplete.resolve(); }); }, }; × Search results Close "},"conversation_controller.js.html":{"id":"conversation_controller.js.html","title":"Source: conversation/controller.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: conversation/controller.js const logger = require('../../modules/logger'); const models = require('../../modules/dal/database').models(); const parse = require('co-body'); const conversationHelper = require('../../modules/service/helpers/conversation'); /** * Conversation Controller * * @module conversationController */ module.exports = { /** Find a conversation for a username. @param username {string} - GET /conversation/username */ * findByUserName() { logger.log('debug', 'Get Conversation'); var user = yield models.user.findOne().where({ username: this.params.id }); this.body = yield models.conversation.find().populate('messages').populate('participants', { where: { id: user.id } }).then(function (conversations) { logger.log('debug', `Got ${conversations.length} conversations for ${user.username}.`) return conversations; }); }, /** Create a new conversation. @param JSON {string} - POST /conversation/create Example request body: { &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;subject&quot;: &quot;Dear Friend&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot; } */ * create() { const body = yield parse.json(this); var to = yield conversationHelper.findUserByName(body.to); var from = yield conversationHelper.findUserByName(body.from); var newConversation = yield models.conversation.create(); newConversation.subject = body.subject; newConversation.participants.push(to); newConversation.participants.push(from); var date = new Date(); var newMessage = yield models.message.create({ to: to.id, from: from.id, messageText: body.message, seen: false, date: date }); newConversation.messages.push(newMessage); logger.log('debug', `Create conversation between ${to.id} and ${from.id}`); this.body = yield models.conversation.update(newConversation.id, newConversation); }, * destroy() { logger.log('debug', `Destory conversation ${this.params.id}.`); models.conversation.findOne().where({ id: this.params.id }).populate('messages').then(function (conversation) { if (!conversation || conversation.messages.length == 0) { return } conversation.messages.forEach(message =&gt; { message.destroy(); }); }); this.body = yield models.conversation.destroy({ id: this.params.id, }); }, /** Update a conversation with a new message. @param JSON {string} - PUT /conversation Example request body: { &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot; } */ * update() { const body = yield parse.json(this); logger.log('debug', `Update conversation ${body.conversationId}.`); var conversation = yield models.conversation.findOne( {id: body.conversationId} ).populate('messages'); if (!conversation) return this.body = '{ &quot;INFO&quot;: &quot;No conversation found matching requested conversationId.&quot;}'; var to = yield conversationHelper.findUserByName(body.to); var from = yield conversationHelper.findUserByName(body.from); var date = new Date(); var newMessage = yield models.message.create({ to: to.id, from: from.id, messageText: body.message, seen: false, date: date }); conversation.messages.push(newMessage); this.body = yield models.conversation.update(conversation.id, conversation); }, }; × Search results Close "},"conversation_model.js.html":{"id":"conversation_model.js.html","title":"Source: conversation/model.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: conversation/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * Conversation Model * * @module conversationModel */ module.exports = Waterline.Collection.extend({ identity: 'conversation', tableName: 'conversations', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { participants: { collection: 'user', }, messages: { collection: 'message', }, datestarted: 'datetime', subject: 'string' }, }); × Search results Close "},"conversation_routes.js.html":{"id":"conversation_routes.js.html","title":"Source: conversation/routes.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: conversation/routes.js 'use strict'; const router = require('koa-router')(); const controller = require('./controller'); const apiRoot = '/conversation'; /** * Conversation Routes * * @module conversationRoutes */ module.exports = (server) =&gt; { router .get(`${apiRoot}/:id`, controller.findByUserName) .put(`${apiRoot}/`, controller.update) .del(`${apiRoot}/:id`, controller.destroy) .post(`${apiRoot}/add`, controller.create) server.use(router.routes()); }; × Search results Close "},"logger_index.js.html":{"id":"logger_index.js.html","title":"Source: logger/index.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: logger/index.js const winston = require('winston'); var logger = new(winston.Logger)({ transports: [ new(winston.transports.Console)({ level: process.env.LOGLEVEL }) ] }); /** * logger module * * @module logger */ module.exports = { /**Set level in .ENV file. @param level {string} @param message {string} */ log(level, message) { if (!level) return logger.info(message); return logger.log(level, message); }, }; × Search results Close "},"conversation_message_model.js.html":{"id":"conversation_message_model.js.html","title":"Source: conversation/message/model.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: conversation/message/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * Message Model * * @module messageModel */ module.exports = Waterline.Collection.extend({ identity: 'message', tableName: 'messages', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { from: { model: 'user' }, to: { model: 'user' }, date: 'datetime', seen: 'boolean', messageText: 'string' }, }); × Search results Close "},"user_controller.js.html":{"id":"user_controller.js.html","title":"Source: user/controller.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: user/controller.js const logger = require('../../modules/logger'); const models = require('../../modules/dal/database').models(); const parse = require('co-body'); const userHelper = require('../../modules/service/helpers/conversation'); /** * User Controller * * @module userController */ module.exports = { /** Find a user by username. @param username {string} - GET /user/username */ * findByUserName() { this.body = yield userHelper.findUserByName(this.params.id); }, /** Create a new user. @param JSON {string} - POST /user/create Example request body: { &quot;username&quot;: &quot;Joe Fox&quot; } */ * create() { const body = yield parse.json(this); logger.log('debug', `Create user ${body.username}`); this.body = yield models.user.find().where({ username: body.username }).then(function (existingUsers) { if (existingUsers.length &gt; 0) { return JSON.parse('{ &quot;INFO&quot;: &quot;Username already exists choose another.&quot;}'); } else { return models.user.create(body); } }); }, /** Get all users. GET /user */ * getAll() { this.body = yield models.user.find(); }, /** Delete a user by username. @param username {string} - DEL /user/username */ * destroy() { logger.log('debug', `Destroy user ${this.params.id}`); this.body = yield models.user.find().where({ username: this.params.id }).then(function (users) { if (users.length == 0) { return JSON.parse('{ &quot;INFO&quot;: &quot;No users found by that name.&quot;}'); } var userName = users[0].username; users.forEach(user =&gt; { user.destroy(); }); return JSON.parse('{ &quot;INFO&quot;: &quot;Destroyed: ' + users.length + ' ' + userName + '.&quot;}'); }) }, }; × Search results Close "},"user_model.js.html":{"id":"user_model.js.html","title":"Source: user/model.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: user/model.js 'use strict'; const mongo = require('sails-mongo'); const Waterline = require('waterline'); /** * User Model * * @module userModel */ module.exports = Waterline.Collection.extend({ identity: 'user', tableName: 'users', adapter: mongo, connection: 'cloudMDBConn', schema: true, autoCreatedAt: true, autoUpdatedAt: true, autoPK: true, attributes: { username: 'string' }, }); × Search results Close "},"user_routes.js.html":{"id":"user_routes.js.html","title":"Source: user/routes.js","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Source: user/routes.js 'use strict'; const router = require('koa-router')(); const controller = require('./controller'); const apiRoot = '/user'; /** * User Routes * * @module userRoutes */ module.exports = (server) =&gt; { router .get(`${apiRoot}`, controller.getAll) .get(`${apiRoot}/:id`, controller.findByUserName) .del(`${apiRoot}/:id`, controller.destroy) .post(`${apiRoot}/add`, controller.create) server.use(router.routes()); }; × Search results Close "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Modules × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes × Search results Close "},"module-app.html":{"id":"module-app.html","title":"Module: app","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: app App Source: service/index.js, line 8 × Search results Close "},"module-conversationController.html":{"id":"module-conversationController.html","title":"Module: conversationController","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: conversationController Conversation Controller Source: conversation/controller.js, line 7 Methods &lt;static&gt; create(JSON) Create a new conversation. Parameters: Name Type Description JSON string POST /conversation/createExample request body:{ &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;subject&quot;: &quot;Dear Friend&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot;} Source: conversation/controller.js, line 43 &lt;static&gt; findByUserName(username) Find a conversation for a username. Parameters: Name Type Description username string GET /conversation/username Source: conversation/controller.js, line 16 &lt;static&gt; update(JSON) Update a conversation with a new message. Parameters: Name Type Description JSON string PUT /conversationExample request body:{ &quot;from&quot;: &quot;Joe Fox&quot;, &quot;to&quot;: &quot;Kathleen Kelly&quot;, &quot;message&quot;: &quot;You know, sometimes I wonder...&quot;} Source: conversation/controller.js, line 99 × Search results Close "},"module-conversationModel.html":{"id":"module-conversationModel.html","title":"Module: conversationModel","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: conversationModel Conversation Model Source: conversation/model.js, line 6 × Search results Close "},"module-conversationRoutes.html":{"id":"module-conversationRoutes.html","title":"Module: conversationRoutes","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: conversationRoutes Conversation Routes Source: conversation/routes.js, line 9 × Search results Close "},"module-logger.html":{"id":"module-logger.html","title":"Module: logger","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: logger logger module Source: logger/index.js, line 10 Methods &lt;static&gt; log(level, message) Set level in .ENV file. Parameters: Name Type Description level string message string Source: logger/index.js, line 20 × Search results Close "},"module-messageModel.html":{"id":"module-messageModel.html","title":"Module: messageModel","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: messageModel Message Model Source: conversation/message/model.js, line 6 × Search results Close "},"module-userController.html":{"id":"module-userController.html","title":"Module: userController","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: userController User Controller Source: user/controller.js, line 7 Methods &lt;static&gt; create(JSON) Create a new user. Parameters: Name Type Description JSON string POST /user/createExample request body:{ &quot;username&quot;: &quot;Joe Fox&quot;} Source: user/controller.js, line 27 &lt;static&gt; destroy(username) Delete a user by username. Parameters: Name Type Description username string DEL /user/username Source: user/controller.js, line 52 &lt;static&gt; findByUserName(username) Find a user by username. Parameters: Name Type Description username string GET /user/username Source: user/controller.js, line 16 &lt;static&gt; getAll() Get all users. GET /user Source: user/controller.js, line 46 × Search results Close "},"module-userModel.html":{"id":"module-userModel.html","title":"Module: userModel","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: userModel User Model Source: user/model.js, line 6 × Search results Close "},"module-userRoutes.html":{"id":"module-userRoutes.html","title":"Module: userRoutes","body":" Youve Got Mail Modules appconversationControllerconversationModelconversationRoutesloggermessageModeluserControlleruserModeluserRoutes Module: userRoutes User Routes Source: user/routes.js, line 9 × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
